# java参考实现分析

## 基于antlr的词法及语法分析

在[参考实现](https://github.com/decaf-lang/minidecaf/tree/md-xxy)中，我们[使用antlr生成对应的语法树](./antlr.md)，并在其基础上进行遍历，完成后续的语义检查及目标代码生成阶段。如果想自己实现一个parser，也可以实现自动机或使用暴力匹配的方法，生成对应的语法树。

## 语义检查

在lab1中，我们需要在生成的语法树上用遍历的方式进行对应的语义检查。在遍历时，我们为每一个分析树节点计算一个类型（`Type`），对于没有类型的节点用 `NoType` 留空。参考实现中，我们在[Type.java](https://github.com/decaf-lang/minidecaf/blob/md-xxy/src/main/java/minidecaf/Type.java)中对类型进行了定义。由于在lab1中需要进行的类型检查非常简单，只有正整数越界检查，因此我们只需定义需要进行类型检查的 `IntType` 类型和不需类型检查的 `NoType` 类型。在遍历时，若遍历到`expr`，则说明只有一个正整数，进行类型检查即可完成对应的语义检查。

我们还需要实现对于main函数的检查（参考实现中并没有），在遍历到函数时判断一下，若遍历整个语法树仍没有看到main函数报错即可。

## 目标代码生成

在lab1中，我们需要实现的目标代码生成非常简单。参考[这个文档](./part1.md)，在遍历语法树时，见到函数时将声明、返回对应的汇编代码加入输出串，将函数体对应的代码放在中间；见到表达式中的数字时将当前的数放入对应的返回寄存器`a0`即可。