# 大实验参考文档

## 介绍

大实验编译器目标：完成一个具有编译优化功能的高性能编译器。

为了简化课程实验，我们的基础实验框架在设计时并未考虑大实验的需求（例如：IR的类型系统简易）

## 参考实现进度及顺序

1. 设计IR (一周)
    这一步也是需要进行代码编写的，可以参考基础实验框架的IR在代码层面是如何实现的（`utils/tac`）。

2. 完成前端 & 后端（一个月）
    - 前端：你可以使用现有的框架完成前端（如：Antlr、Flex & Bison）辅助你生成AST，完成词法分析、语法分析、语义分析以及中间代码生成。如果你想在这个过程中锻炼你对分析方法的理解，你可以自己实现LR(1)、LL(1)等分析器。

    - 后端：先实现一个简单的寄存器分配方案，保证编译器能够正确运行，然后再考虑优化。

    前端和后端是可以并行进行的，只要你们遵循相同的IR设计，前后端的开发是可以分开的。

4. 增加中端优化和后端优化（剩下的时间）
    - 中端优化：死代码消除、常量传播、复写传播、循环不变量外提等等
    - 后端优化：图染色寄存器分配、现行扫描法、指令折叠等等

## 评分方法

因为大实验实现难度较高且工作量较大，优化目标可能相对难以完成，因此我们给出两种评分方案：

- 选项一 完成竞赛第二阶段的优化编译器，替代期末考试
    
    成绩占比 90%，剩余 10% 为书面作业和日常成绩。

    你需要通过 stage 1-6 的所有测试样例以及附加测试的测试样例，这样你可以获得 50% 的正确性得分。剩下的 40% 的得分将根据你的编译器的性能进行评分。

    性能评分方案：
    附加测试中`performance`部分测试样例，以gcc打开`-O2`优化的性能的 60% 为满分，按照比例折算。如果一个程序gcc编译后运行时间为 12s ，如果你的程序执行时间为 20s 即为满分。

    你的单个测试点的得分为：
    ```
    min{100, 100 * GCC编译程序运行时间 * 1.25/你的程序运行时间}
    ```
    所有测试点取**几何平均值**，最后结果 * 40% 作为你的最终性能测试成绩。

    你也可以选择参加期末考，那么你的成绩将会是评分方案一、二取最高的一个。

- 选项二 仅完成竞赛第一阶段（达到课程基础实验的要求）

    实验部分占比与基础实验一致，你不需要完成思考题，但是需要简单介绍你的编译器是怎么完成每一个 step 的。根据通过测试样例情况评分。

    - 完成 stage 1 - 5 实验成绩 35% ，书面作业和日常成绩10% ，期末成绩 55%。
    - 完成 stage 1 - 6 实验成绩 42% ，书面作业和日常成绩10% ，期末成绩 48%。
    - 完成 stage 1 - 7 实验成绩 50% ，书面作业和日常成绩10% ，期末成绩 40%。